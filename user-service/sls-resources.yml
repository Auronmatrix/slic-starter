apiKeyRetrievalFunctionRole:
  Type: AWS::IAM::Role
  Properties:
    RoleName: ${self:custom.stage}-cf-api-key-retrieval-role
    AssumeRolePolicyDocument:
      Version: '2012-10-17'
      Statement:
        - Effect: Allow
          Principal:
            Service: [lambda.amazonaws.com]
          Action: [sts:AssumeRole]
    Path: /

apiKeyRetrievalFunction:
  Type: AWS::Lambda::Function
  Properties:
    Code:
    Description: CloudFormation Custom Resource to fetch API Key
    Handler:
    Role: !Ref apiKeyRetrievalFunctionRole
    Runtime: nodejs8.10

userServiceNameParameter:
  Type: AWS::SSM::Parameter
  Properties:
    Name: UserServiceUrl
    Type: String
    Value:
      Fn::Join:
        - ''
        - - 'https://'
          - !Ref ApiGatewayRestApi
          - '.execute-api.${self:custom.region}.amazonaws.com/${self:custom.stage}/user/'
